"use strict";function WEBRTC(configuration=null,polite=!1){const pc=new RTCPeerConnection(configuration||{iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}]});let sendHandler=null;const send=e=>{sendHandler&&"function"==typeof sendHandler&&sendHandler(e)};let errorHandler=null;const error=err=>{errorHandler&&"function"==typeof errorHandler&&errorHandler(err)};let connectedHandler=null;let disconnectedHandler=null;let dataChannels={},dataChannelHandler=null;let tracks={},trackHandler=null;pc.oniceconnectionstatechange=(e=>{"connected"===e.target.iceConnectionState&&connectedHandler&&"function"==typeof connectedHandler&&connectedHandler({type:"connected"}),"disconnected"===e.target.iceConnectionState&&disconnectedHandler&&"function"==typeof disconnectedHandler&&disconnectedHandler({type:"disconnected"}),"failed"===e.target.iceConnectionState&&pc.restartIce()});let makingOffer=!1;pc.onnegotiationneeded=(async()=>{try{makingOffer=!0;let offer=await pc.createOffer();await pc.setLocalDescription(offer).then().catch(error),send({description:pc.localDescription})}catch(err){error(err)}finally{makingOffer=!1}}),pc.onicecandidate=(({candidate:candidate})=>send({candidate:candidate})),pc.ondatachannel=(e=>{dataChannelHandler&&"function"==typeof dataChannelHandler&&dataChannelHandler(e),dataChannels[e.channel.label]=e.channel}),pc.ontrack=(e=>{trackHandler&&"function"==typeof trackHandler&&trackHandler(e),tracks[e.track.id]=e.track});let ignoreOffer=!1;return{peerConnection:pc,createDataChannel:(label=null,options={})=>{let dataChannel=pc.createDataChannel(label,options);return dataChannels[label]=dataChannel,dataChannel},addTrack:(track,stream)=>pc.addTrack(track,stream),listen:async({description:description,candidate:candidate})=>{try{if(description){const offerCollision="offer"==description.type&&(makingOffer||"stable"!=pc.signalingState);if(ignoreOffer=!polite&&offerCollision)return;if(await pc.setRemoteDescription(description).then().catch(error),"offer"==description.type){let answer=await pc.createAnswer();await pc.setLocalDescription(answer).then().catch(error),send({description:pc.localDescription})}}else if(candidate)try{await pc.addIceCandidate(candidate).then().catch(error)}catch(err){if(!ignoreOffer)throw err}}catch(err){error(err)}},onSend:cb=>{sendHandler=cb},onError:cb=>{errorHandler=cb},onTrack:cb=>{trackHandler=cb},onDataChannel:cb=>{dataChannelHandler=cb},onConnected:cb=>{connectedHandler=cb},onDisconnected:cb=>{disconnectedHandler=cb},tracks:tracks,dataChannels:dataChannels,close:()=>{pc.close(),disconnectedHandler&&"function"==typeof disconnectedHandler&&disconnectedHandler({type:"disconnected"})}}}